# 点击穿透的原因和解决方案是什么

## 原因

2007 年初。苹果公司在发布首款 iPhone 前夕，遇到一个问题：当时的网站都是为大屏幕设备所设计的。于是苹果的工程师们做了一些约定，应对 iPhone 这种小屏幕浏览桌面端站点的问题。这当中最出名的，当属双击缩放(double tap to zoom)，这也是会有上述 300 毫秒延迟的主要原因。双击缩放，顾名思义，即用手指在屏幕上快速点击两次，iOS 自带的 Safari 浏览器会将网页缩放至原始比例。 那么这和 300 毫秒延迟有什么联系呢？ 假定这么一个场景。用户在 iOS Safari 里边点击了一个链接。由于用户可以进行双击缩放或者双击滚动的操作，当用户一次点击屏幕之后，浏览器并不能立刻判断用户是确实要打开这个链接，还是想要进行双击操作。因此，iOS Safari 就等待 300 毫秒，以判断用户是否再次点击了屏幕。

click 是在移动端有 300ms 的延迟，混用 click 和 touch 会导致穿透事件。

## 类型

### 1. 蒙层穿透

蒙层的关闭按钮绑定的是 touch 事件，而按钮下面元素绑定的是 click 事件，touch 事件触发之后，蒙层消失了，300ms 后这个点的 click 事件 fire，event 的 target 自然就是按钮下面的元素，因为按钮跟蒙层一起消失了

### 2. 跨页面点击穿透

跨页面点击穿透问题：如果按钮下面恰好是一个有 href 属性的 a 标签，那么页面就会发生跳转

因为 a 标签跳转默认是 click 事件触发，所以原理和上面的完全相同

## 解决方案

### 1. 不要混用 touch 和 click

既然 touch 之后 300ms 会触发 click，只用 touch 或者只用 click 就自然不会存在问题了

### 2. 正确处理 touch 300m 延迟后同位置的 click 事件

1. tap 后延迟 350ms 再隐藏 mask

2. 在下面元素的事件处理器里做检测（配合全局 flag）

3. pointer-events

   mask 隐藏后，给按钮下面元素添上 `pointer-events: none;` 样式，让 click 穿过去，350ms 后去掉这个样式，恢复响应

## 参考资源

- [点击穿透事件原因及解决办法](https://www.cnblogs.com/leftJS/p/11095226.html)
