# TableZ

## 需求

1. 用户输入编辑
2. cell 依赖计算，可能有循环依赖，不过一次更新触发的依赖具有方向性
3. 用户可以回撤

## 实现

1. 性能问题

   1. 减少 diff 节点，只在更新行列数量的时候，对表格整体更新
   2. 当用户输入的时候，只对 cell 进行 diff
      1. 联动的 cell 数量不会很多

2. 依赖计算

   1. 根据每一个 cell，抽象出一个依赖树，cell 作为根结点
      1. 当用户输入的时候，广度优先遍历树，根据规则计算
   2. 异步计算
      1. 如果一个节点的计算规则是异步得到的结果，这个计算称作异步计算
      2. 对每个 cell 增加状态 pending-start，子树节点也都进入 pending 状态，保证数据栈的连续性
         1. 同时 pending-start 的节点要保存依赖树的 paths，等计算结果异步产生的时候，从当前节点开始继续遍历子树做计算

3. 用户回撤

   1. 用户点击回撤，或者在某一个 cell 上执行回撤快捷键，相关的数据都要回溯到上一个状态，这样对于 cell 值都存储就需要用一个数组存放
      1. 我们使用栈来存放，栈顶数据永远作为显示数据
   2. 当用户回撤都时候，将依赖树上的节点的数据栈 pop
