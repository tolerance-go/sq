# 如何将企业内部项目和开源平台打通

## 需求

企业内部使用开源项目的好处就不多说了，这里想讨论的是如何在日常开发中，将开源项目和依赖方：业务项目的开发进度有效结合起来。

这里的有效是指以下问题可以被解决：

1. 本地开发遇到框架内部 bug，但是需要立马上线，应该存在某种机制可以顺利保证项目上线，同时可以在后续过程中在框架内部把 bug 解决掉
2. 新功能的开发如果是在框架级别的，应该作为增强代码合并到开源仓库，保证了良好分层的前提下，可以和社区互动，为新功能代码添加保证
   1. 所有 github 用户都可以对新功能代码进行审查，减少代码 bug 产生
   2. 所有 github 用户都可以对新功能业务提出改进建议

## 解决方案

大概思路就是：我们在本地和外网的 npm 及 github 之间设置一道缓存机制，业务中实际使用的是缓存中的代码，定期同步缓存，缓存可能超前于源码仓库，因为我们可以自主控制分支的优先合并，存在最终源代码仓库没有同意合并的情况。

1. 通过 github fork 对开源项目进行 clone，fork 后仓库位置存在在 公司组织下 方便管理
2. 仔细阅读开源项目的贡献指南
   1. 仔细阅读开发，测试及发布的流程和约定
3. 从主分支新建 experiment 分支，作用是：
   1. 内部仓库的发布分支
   2. 业务端产生的 bug 和功能分支优先合并的目标分支
4. 将 ci 流程本地化
5. 将发布流程本地化，替换环境变量等

## 操作流程

### 如何同步源码仓库到本地项目

1. 如果存在超前分支，一般是有新版本发布了，在主分支拉取代码
2. 提交 PR 到 experiment 分支
3. 发布 experiment

### 产生框架级别的 bug 该如何操作分支

1. 从 master（以 antd 的贡献指南为参考）切出 fix 分支，修复完成后合并到 experiment
2. 发布 experiment
3. 提交 PR 到原仓库

## 注意

1. 尽量保证 experiment 和 主分支的同步
   1. 定期更新
   2. 新功能切勿包含业务，保证能够和社区代码合并
2. 不要在 experiment 分支上切出新分支去解决 bug 和增加功能，除非是由未被采纳的功能导致的 bug，这个分支注意是无法合并回主开源仓库的
